<!DOCTYPE html>
<html lang="en">
    <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116498471-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-116498471-1');
    </script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WG2KK6D');</script>
    <!-- End Google Tag Manager -->

{% load static_url %}
{% block local_css %}

    <meta name="login" content="send_initial_mail_confirm_login">
    <link rel="stylesheet" href={% static_url "user/css/trainer/pters.trainer.register.css" %}>
    <style type="text/css">
    	#submit_input{
    		overflow-y: hidden;
    		margin: 0;
    		transition: 0.3s;
    		-webkit-transition: 0.3s;
    	}
    	#submit_complete{
    		height: 0;
    		transition: 0.5s;
    		-webkit-transition: 0.5s;
    		overflow-y: hidden;
    		margin: 0;
    		padding-left: 20px;
    		font-size: 14px;
    	}
    	.submit_email_confirm,.submit_go_home{
    		position: relative !important;
    		margin: 0 auto !important;
    		margin-top: 40px !important;
    		left: unset !important;
    		transform: unset !important;
    	}
    	.submit_go_home{
    		color: #fe4e65 !important;
    		position: relative !important;
    		margin: 0 auto !important;
    		margin-top: 15px !important;
    		left: unset !important;
    		transform: unset !important;
    	}
    	#ajaxloadingPC{
			position: fixed;
			display: none;
			height: 60px;
			left: 50%;
			transform:translate(-50%,-50%);
			z-index: 202;
		  }

      #id_email{
        width: 220px;
        height: 25px;
        font-size: 15px;
      }

      .pw_confirm{
        position: absolute;
        margin: 0;
        display: inline;
        left: 0;
        margin-left: 35px;
      }


      #errorMessageBar{
          display: none;
          width: 100%;
          position: sticky;
          top: 0;
          left: 0;
          height: 35px;
          text-align: center;
          background: red;
          color: #ffffff;
          font-size: 15px;
          font-weight: bold;
          z-index: 1500;
      }   
          #errorMessageBar span{
              line-height: 35px;
          }
          #errorMessageBar span:nth-child(2){
              position: absolute;
              right: 0;
              margin-right: 85px;
              cursor: pointer;
          }

    </style>

{% endblock %}
    </head>
{% load i18n %}

    <body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WG2KK6D"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
{% block content %}

<div id="errorMessageBar">
    <span id="errorMessageText"></span><span>닫기</span>
</div>

<div class="outerbox_horizontal" data-view="init" style="width:auto;">
	<div class="explainbox _type_trainee" style="width: 315px;">
		<img src="/static/user/res/login/icon-reg-user.png">
		<p><span class="font-pink">이메일 인증</span></p>
    <p>PTERS를 처음 사용하시는 분께서는<br>이메일 인증 후 서비스를 이용하실 수 있습니다.</p>
		<div class="explaintype" id="submit_input">
			<form method="post" action="." style="text-align: center!important;padding-left: 20px;">
			  	{% csrf_token %}
                <input type="hidden" name="username" value="{{ request.session.username }}">
                <input type="hidden" name="password" id="id_password">
                <input type="hidden" name="email" id="id_email">
                <input type="hidden" name="member_type" value="new">

			  	<!--<input type="submit" value="{% trans 'Submit' %}" />-->

          <p style="line-height: 25px;">
              ID : <input type="" name="id" placeholder="ID"  id="id_input">

          </p>
          <p style="line-height: 25px;">
               <input type="" name="" placeholder="이메일"  id="email_input"> @
               <input type="" name="" placeholder="이메일 뒷부분"  id="email_input_re" readonly>
               <select class="login_dropdown" id="email_option">
                   <option id="optionnone">선택</option>
                   <option id="gmail">gmail.com</option>
                   <option id="naver">naver.com</option>
                   <option id="daum">daum.net</option>
                   <option id="self">직접 입력</option>
               </select>
          </p>
          <p style="line-height: 25px;">
            새 비밀번호  : <input type="password" style="margin-left: 12px;" name="newpassword" id="pw_input"><br>
            비밀번호 확인 : <input type="password" name="newpassword_check" id="pw_input_re">
          </p>
          <p class="pw_confirm">영문 대소문자/숫자/특수문자를 포함한 8자이상</p>
			</form>	
			<button class="submit_email_confirm" >인증 메일 보내기</button>
			<button class="submit_go_home" onclick="goHome()">뒤로</button>
			<img src="/static/user/res/ajax/loading.gif" alt="" class="ajaxloadingPC" id="ajaxloadingPC">
		</div>
		<div class="explaintype" id="submit_complete">
			<p>입력하신 메일주소로</p>
			<p>인증메일이 발송되었습니다.</p>
			<p>메일 확인하여 계정을 활성화 해주세요.</p>
			<button class="submit_go_home" onclick="goHome()">로그인 페이지</button>
		</div>
	</div>
</div>

{% endblock %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>

  passwordCheck()

	$('button.submit_email_confirm').click(function(){
    if($('.pw_confirm').attr('data-check') == 1){
      $form = $('#submit_input form')
      $.ajax({
                url:'/login/resend_email_authentication/',
                type:'POST',
                data:$form.serialize(),
                dataType : 'html',

                beforeSend:function(){
                  beforeSend()
                },

                //보내기후 팝업창 닫기
                complete:function(){
                  completeSend()
                },

                //통신성공시 처리
                success:function(data){
                    var jsondata = JSON.parse(data)
                    if(jsondata.messageArray.length>0){
                      $('#errorMessageBar').show()
                      $('#errorMessageText').text(jsondata.messageArray)
                    }else{
                      $('#submit_complete').css('height','200px')
                      $('#submit_input').css('height','0px')
                      $('.pw_confirm').text('')
                    }
                },

                //통신 실패시 처리
                error:function(){
                  alert("서버 통신 에러가 발생하였습니다. 잠시후 다시 시도해주세요")
                },
            })
    }else{
      alert('비밀번호를 다시 확인해주세요')
    }
		
	})

  $('#errorMessageBar span:nth-child(2)').click(function(){
      $('#errorMessageBar').fadeOut()
      $('#errorMessageText').text('')
  })

	function beforeSend(){
        $('html').css("cursor","wait");
        $('#ajaxloadingPC').css('display','block');
        $('#submit_input button').css('visibility','hidden')
  }

  function completeSend(){
      $('html').css("cursor","auto");
      $('#ajaxloadingPC').css('display','none');
      $('#submit_input button').css('visibility','visible')
  }

  function goHome(){
      location.href="{% url 'login:logout' %}"
  }

  function passwordCheck(){
      $('#pw_input_re').keyup(function(){
        if($('#pw_input').val().length > 0){
            if($(this).val().length==0){
                $('.pw_confirm').text('영문 대소문자/숫자/특수문자를 포함한 8자이상').css('color','#ffffff')
                $('.pw_confirm').attr('data-check',0)
            }else if($(this).val() != $('#pw_input').val()){
                $('.pw_confirm').text('비밀번호 불일치').css({'display':'inline','color':'#fe4e65'})
                $('.pw_confirm').attr('data-check',0)
                $('#id_password').attr('value',"")

            }else{
                $('.pw_confirm').text('비밀번호 일치').css({'display':'inline','color':'green'})
                $('.pw_confirm').attr('data-check',1)
                $('#id_password').attr('value',$(this).val())
            }
        }else{
            $('.pw_confirm').text('영문 대소문자/숫자/특수문자를 포함한 8자이상').css('color','#ffffff')
            $('.pw_confirm').attr('data-check',0)
        }
      })
  }

    $('#email_input').keyup(function(){
        if($('#email_input_re').val().length>0){
            $('#id_email').attr('value', $(this).val()+'@'+$('#email_input_re').val())
        }else{
            $('#id_email').attr('value',"")
        }
    })

    $('#email_option').change(function(){
        if($(this).val() =="직접 입력"){
            $('#email_input_re').attr('readonly',false).val("")
            $('#email_input_re').keyup(function(){
                if($('#email_input').val().length>0){
                    $('#id_email').attr('value', $('#email_input').val()+'@'+$('#email_input_re').val())
                }else{
                    $('#id_email').attr('value',"")
                }
            })
        }else if($(this).val()!="선택"){
            $('#email_input_re').val($(this).val())
            $('#email_input_re').attr('readonly',true)
        }else{
            $('#email_input_re').attr('readonly',true).val("")
        }

        if($('#email_input').val().length>0){
            $('#id_email').attr('value', $('#email_input').val()+'@'+$('#email_input_re').val())
        }else{
            $('#id_email').attr('value',"")
        }
    })


</script>

    </body>
</html>
