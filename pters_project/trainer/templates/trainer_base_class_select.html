<!DOCTYPE html>
<html lang="en">
<head>
    {% load static_url %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable:no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>{% block title %}PTERS{% endblock %}</title>

    <link rel="icon" href="/static/common/favicon.ico">
    <link rel="apple-touch-icon" href="/static/common/favicon-48.png">
    <link rel="shortcut icon" href="/static/common/favicon-48.png">

    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- Bootstrap core CSS -->
    <link href={% static_url "common/css/bootstrap.min.css" %} rel="stylesheet">
    <link rel="stylesheet" href={% static_url "user/css/pters.base.set.css" %}>
    <link rel="stylesheet" href={% static_url "user/css/pters.base.popup.css" %}>
    <link rel="stylesheet" href={% static_url "user/css/pters.common.module.css" %}>
    <link rel="stylesheet" href={% static_url "user/css/trainer/pters.trainer.select.class.css" %}>
    <link rel="stylesheet" href={% static_url "common/css/swiper.min.css"%}>

    {% block local_css %}
    {% endblock %}
</head>
<body>
{% block navbar %}
    <div id="shade"></div>
    <div id="shade3"></div>


    <div id="popup_lecture_select" class="popups">
        <form action="{% url 'trainer:select_program_processing' %}" id="lecture-check-form" method="post">
            {% csrf_token %}
            <input type="hidden" name="class_id" id="id_class_id">
            <input type="hidden" name="next_page" id="id_next_page" value="{% url 'trainer:index' %}">
        </form>
        <label>프로그램 선택<img src="/static/user/res/ptadd/btn-x.png" class="button_close_popup"></label>
        <p id="popup_lecture_select_title">
            <span class="text-moveprogram"></span>
            <img src="/static/user/res/ptadd/btn-x.png" class="button_close_popup">
        </p>
        <!--
        <div class="pters_table">
            <div class="pters_table_cell_head table_center_name"><span class="KRtext">센터</span><span class="JPtext">センター</span><span class="ENtext">Center</span></div>
            <div class="pters_table_cell_head table_lecture_name"><span class="KRtext">클래스</span><span class="JPtext">クラス</span><span class="ENtext">Class</span></div>
            <div class="pters_table_cell_head table_trainee_num"><span class="KRtext">수강생</span><span class="JPtext">受講生</span><span class="ENtext">Member</span></div>
            <div class="pters_table_cell_head table_start_date"><span class="KRtext">개강일</span><span class="JPtext">開始</span><span class="ENtext">Open Date</span></div>
            <div class="pters_table_cell_head table_lecture_status"><span class="KRtext">상태</span><span class="JPtext">状態</span><span class="ENtext">Status</span></div>
        </div>
        -->
        <div class="lecture_select_table_list">
        </div>
    </div>


{% endblock %}

{% block content %}
{% endblock %}



{% block footer %}

{% endblock %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"> //미니달력</script>
<script src={% static_url "common/js/bootstrap.min.js" %}></script>
<script type="text/javascript" src={% static_url "common/js/jquery.swipe.js" %}></script>
<script type="text/javascript" src={% static_url "common/js/jquery.touch.js" %}></script>
<script type="text/javascript" src={% static_url "common/js/swiper.jquery.min.js" %}></script>

<script>

    $('#shade, #shade3').click(function(){
        $('.popups').css('display','none')
        $('#shade, #shade3').css('display','none')
        if($('body').width()>600){
            $('#calendar').css('position','relative')
        }
    })

    var class_background_img_url= [];
    var class_background_type_cd = [];

    function openNav(){
        $("#outer_Sidenav").show();
        $("#inner_Sidenav").css({'width':'250px'});
        $('#float_btn_wrap, #float_btn').fadeOut()
        //$(".sidebar_text,#user_name,#welcome,.sidebar_icon,.sidebar_upper img").fadeIn('fast')
    }

    function closeNav(){
        $("#outer_Sidenav").hide();
        $("#inner_Sidenav").css({'width':'0'});
        $('#float_btn_wrap, #float_btn').fadeIn()
        //$(".sidebar_text,#user_name,#welcome,.sidebar_icon,.sidebar_upper img").fadeOut('fast')
    };


    var worktime = '{{ request.session.setting_trainer_work_time_available }}'
    var stoptime = '{{ request.session.setting_member_reserve_time_available }}'
    if(stoptime.length>0){
        var stoptimeStart = Number('{{ request.session.setting_member_reserve_time_available }}'.split(':')[0])
        var stoptimeEnd = Number('{{ request.session.setting_member_reserve_time_available }}'.split('-')[1].split(':')[0])
    }else{
        var stoptimeStart = ''
        var stoptimeEnd = ''
    }
    if(worktime.length>0){
        var worktimeStart = Number('{{ request.session.setting_trainer_work_time_available }}'.split(':')[0])
        var worktimeEnd = Number('{{ request.session.setting_trainer_work_time_available }}'.split('-')[1].split(':')[0])
    }else{
        var worktimeStart = ''
        var worktimeEnd = ''
    }

    var Options = {  "stoptimeStart": stoptimeStart ,             //강사가 설정한 예약불가 시간 (시작)
        "stoptimeEnd": stoptimeEnd ,                //강사가 설정한 예약불가 시간 (종료)
        "limit":'{{ request.session.setting_member_reserve_time_prohibition }}',      //현재시간으로부터 몇시간뒤에 일정 추가가능하게 할지 셋팅
        "reserve":'{{ request.session.setting_member_reserve_prohibition }}',    //회원 일정 기능을 enable 1/disable 0

        "firstPushToMember":'-',
        "secondPushToMember":'-',
        "regErgentPushToMember":'-',
        "planChangePush":'-',
        "regErgentPush":'-',

        "workStartTime":worktimeStart,
        "workEndTime":worktimeEnd,

        "language" : "{{ request.session.setting_language }}", //Korea, Japan, English, Chinese, Spanish
        "location" : "Japan",           //Korea, Japan, English, Chinese
    }
    if(Options.language.length == 0){
        Options.language = "KOR"
    }

    if(Options.language=="JPN"){
        $(".KRtext, .ENtext").remove();
        $(".JPtext").show();
    }else if(Options.language=="ENG"){
        $(".KRtext, .JPtext").remove();
        $(".ENtext").show();
    }else if(Options.language=="KOR"){
        $(".ENtext, .JPtext").remove();
        $(".KRtext").show();
    }


    ///********************* 강의 선택*************************************///
    ///********************* 강의 선택*************************************///

    var lec_select_regCountArray = []
    var lec_select_countArray = []
    var lec_select_startArray = []
    var lec_select_endArray = []
    var lec_select_lectureIdArray = []
    var lec_select_trainerNameArray = []
    var lec_select_availCountArray = []
    var lec_select_classIdArray = []


    function ajax_read_lecture_info_from_db(HTMLselector, use, callback){
        $.ajax({

            url: '/trainer/get_program_list/',
            type: 'GET',
            dataType : 'html',

            beforeSend:function(){
            },

            success:function(data){
                var jsondata = JSON.parse(data);
                lec_select_classIdArray = jsondata.classIdArray;
                lec_select_centerNameArray = jsondata.centerNameArray;
                lec_select_subjectNameArray = jsondata.subjectNameArray;
                lec_select_startDateArray = jsondata.startDateArray;
                lec_select_stateNameArray = jsondata.stateNameArray;
                lec_select_classMemberNumArray = jsondata.classMemberNumArray;
                lec_select_classInProgressMemberNumArray = jsondata.classInProgressMemberNumArray;

                lec_select_classHourArray = jsondata.classHourArray;
                lec_select_classHourUnitArray = jsondata.classHourUnitArray;
                lec_select_stateCodeArray = jsondata.stateCodeArray;
                lec_select_subjectCodeArray= jsondata.subjectCodeArray;


                fill_lecture_select_popup(jsondata, HTMLselector);
                if(use == "callback"){
                    callback();
                }
            },

            complete:function(){
            },

            error:function(){
                alert('error');
                console.log('server error');
            }
        })
    }

    function ajax_read_lecture_detail_info_from_db(classid){
        $.ajax({
            url: '/trainee/get_trainee_lecture_list/',
            data:{"class_id": classid, "auth_cd":'WAIT'},
            type:'GET',
            dataType : 'html',

            beforeSend:function(){

            },

            success:function(data){
                var jsondata = JSON.parse(data);
                console.log(jsondata)

                lec_select_regCountArray = jsondata.countArray;
                lec_select_startArray = jsondata.startArray;
                lec_select_endArray = jsondata.endArray;
                lec_select_lectureIdArray = jsondata.lectureIdArray;
                lec_select_classIdArray = jsondata.classIdArray
                lec_select_trainerNameArray = jsondata.trainerNameArray;
                lec_select_availCountArray = jsondata.availCountArray;
                lec_select_stateArray = jsondata.memberViewStateArray;
                lec_select_lectureCountsArray = jsondata.lectureCountsArray;
                //lec_select_npLectureCountsArray = jsondata.npLectureCountsArray;
                lec_select_classInfoArray = jsondata.classInfoArray;
                lec_select_classIdArray = jsondata.classIdArray;

                fill_lecture_connect_select_popup(classid)

            },

            complete:function(){

            },

            error:function(){
                console.log('server error')
            }
        })
    }



    function open_lecture_select_popup(){
        $('#popup_lecture_select').fadeIn('fast');
        ajax_read_lecture_info_from_db($('.lecture_select_table_list'),'callback', function(){
            append_dropdown_scroll_arrow('.lecture_select_table_list', '#popup_lecture_select_title', 35, 0);
            set_list_overflow_scrolling('.lecture_select_table_list', '#popup_lecture_select_title');
        });
    }

    function open_lecture_select_popup_pc(){
        ajax_read_lecture_info_from_db($('#subject-selector'), 'callback', function(){
            append_dropdown_scroll_arrow('#subject-selector', '#myInfo', 50, -60)
            set_list_overflow_scrolling('#subject-selector', '#myInfo');
        });
    }

    function fill_lecture_select_popup(jsondata, HTMLselector){

        var json = class_sort_by_center(jsondata);
        var list_table_to_join = [];
        for(center in json){
            var subject_join = []
            var center_counter = 0;
            var centers = [];
            for(subject in json[center]){
                var className = json[center][subject]['className'];
                var classId = json[center][subject]['classId'];
                var classHour = json[center][subject]['classHour'];
                var classHourUnit = json[center][subject]['classHourUnit'];
                var classIPNumber = json[center][subject]['classInProgressMemberNum'];
                var classMemberNum = json[center][subject]['classMemberNum'];
                var startDt = json[center][subject]['startDate'];
                var endDt = json[center][subject]['endDate'];
                var modDate = json[center][subject]['modDate'];
                var regDate = json[center][subject]['regDate'];
                var stateCode = json[center][subject]['stateCode'];
                var stateName = json[center][subject]['stateName'];
                var subjectCode = json[center][subject]['subjectCode']

                var currentClass = "";
                var table = "";
                var currentIndicator = ""

                    currentClass = "";
                    //var selectionText = '<a data="" '+'onclick="lecture_check('+lec_select_classIdArray[i]+')"'+'">선택</a>'
                    table = '<div class="pters_table lecture_row" style="margin-top:0;" id="classid" data-classid="'+classId+'" '+'onclick="lecture_check('+classId+')"'+'>';
                
                var centerName__ = center;
                if(center == ""){
                    var centerName__ = '센터 미지정'
                }
               
                //var table = '<div class="pters_table" style="margin-top:0;" id="classid" data-classid="'+lec_select_classIdArray[i]+'">'
                var centerName = '<div class="pters_table_cell table_center_name '+currentClass+'">'+centerName__+'</div>';
                var lectureName = '<div class="pters_table_cell table_lecture_name '+currentClass+'">'+currentIndicator+className+'</div>';
                var traineeNum = '<div class="pters_table_cell table_trainee_num '+currentClass+'"> 총 '+classIPNumber+'명</div>';
                var startDate = '<div class="pters_table_cell table_start_date '+currentClass+'">'+startDt+' ~</div>';
                var status = '<div class="pters_table_cell table_lecture_status '+currentClass+'">'+stateName+'</div>';
                //var selection = '<div class="pters_table_cell lecture_selection"  data-classid="'+lec_select_classIdArray[i]+'">'+selectionText+'</div>';
                if(subject_join.length == 0){
                    var sum = table + centerName + lectureName + traineeNum + startDate + status + '</div>';
                }else{
                    var sum = table + lectureName + traineeNum + startDate + status + '</div>';
                }

                subject_join.push(sum);
                if(center != ''){
                    center_counter += 1;
                }
            } //for2
            list_table_to_join.push(subject_join.join(''))
        }//for1
        HTMLselector.html(list_table_to_join.join(''))
    }

    function class_sort_by_center(jsondata){
        var len = jsondata.subjectNameArray.length;
        var center_subject = {}
        for(var i=0; i<len; i++){
            center_subject[jsondata.centerNameArray[i]] = {}
        }
        for(var j=0; j<len; j++){
            center_subject[jsondata.centerNameArray[j]][jsondata.classIdArray[j]] = {}
        }
        for(var k=0; k<len; k++){
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['subjectCode'] = jsondata.subjectCodeArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['classHour'] = jsondata.classHourArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['classHourUnit'] = jsondata.classHourUnitArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['className'] = jsondata.subjectNameArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['classId'] = jsondata.classIdArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['classInProgressMemberNum'] = jsondata.classInProgressMemberNumArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['classMemberNum'] = jsondata.classMemberNumArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['startDate'] = jsondata.startDateArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['endDate'] = jsondata.endDateArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['stateCode'] = jsondata.stateCodeArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['stateName'] = jsondata.stateNameArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['modDate'] = jsondata.modDtArray[k];
            center_subject[jsondata.centerNameArray[k]][jsondata.classIdArray[k]]['regDate'] = jsondata.regDtArray[k];
        }
        console.log(center_subject)
        return center_subject
    }



    $('.button_close_popup').click(function(){
        $(this).parents('div.popups').fadeOut('fast')
        $('#shade,#shade3').hide()
    })

    function lecture_check(class_id){
        //$('#id_check_lecture_id').val(lecture_id);
        //$('#id_check').val(check);
        $('#id_class_id').val(class_id);
        $('#id_next_page').val('{% url 'trainer:index'%}');
        document.getElementById('lecture-check-form').submit();
    }
    $('#upbutton-alarm').css('display','none')

    ///********************* 강의 선택*************************************///
    ///********************* 강의 선택*************************************///

</script>
<script type="text/javascript" src={% static_url "user/js/pters.base.set.js" %}></script>
<script type="text/javascript" src={% static_url "user/js/pters.common.module.js" %}></script>
<script type="text/javascript" src={% static_url "user/js/pters.multi.language.set.js" %}></script>
{% block local_js_footer %}
{% endblock %}

</body>
</html>