{% extends "popup/trainee_base_popup.html" %}
{% load static_url %}
{% block popup_base_css %}
    <!-- pters.trainee.popup.plan_view.css -->
    <link rel="stylesheet" href={% static_url "user/css/trainee/popup/pters.trainee.popup.myinfo_change.css" %}>
{% endblock %}
{% block popup_base_contents %}
    <div class="popup_my_info_change">
        <div class="wrapper_popup_title">
            <div class="obj_font_size_20_weight_bold">내 정보 </div>
        </div>

        <div class="obj_box_full">
            <form id="form_my_info">
                {% csrf_token %}
                <div style="display: none">
                    {{ form.as_p }}
                </div>
                <article>
                    <div class="wrapper_sub_title obj_font_size_11_weight_500 obj_font_color_dark_grey">이름</div>
                    <input type="text" name="first_name" class="obj_font_size_14_weight_500" placeholder="{{ member_info.name }}">
                </article>
                <article>
                    <div class="wrapper_sub_title obj_font_size_11_weight_500 obj_font_color_dark_grey">아이디</div>
                    <input type="text" name="id" class="obj_font_size_14_weight_500" placeholder="{{ member_info.user.username }}" style="" disabled>
                </article>
                <article>
                    <div class="wrapper_sub_title obj_font_size_11_weight_500 obj_font_color_dark_grey">생년월일</div>
                    <input type="date" name="birthday" class="obj_font_size_14_weight_500" value="{{ member_info.birthday_dt }}" max="2025-12-31" min="1919-01-01">
                </article>
                <article>
                    <div class="wrapper_sub_title obj_font_size_11_weight_500 obj_font_color_dark_grey">연락처</div>
                    <input type="tel" name="phone" class="obj_font_size_14_weight_500" placeholder="{{ member_info.phone }}">
                </article>
                <article>
                    <div class="wrapper_sub_title obj_font_size_11_weight_500 obj_font_color_dark_grey">이메일</div>
                    <input type="email" name="email" class="obj_font_size_14_weight_500" placeholder="{{ member_info.user.email }}" disabled>
                </article>


                <!-- <input type="hidden" name="last_name" id="last_name" value="" >
                <input type="hidden" name="sex" id="newsex" value="" >
                <input type="hidden" name="contents" id="contents" value="" > -->
                <input type="hidden" name="next_page" id="id_next_page" value="{% url 'trainee:get_trainee_info' %}">


            </form>
        </div>
    </div>
{% endblock %}

{% block popoup_base_wrapper_bottom_inside %}
    <div class="obj_button_big obj_font_bg_white_pink" onclick="func_send_my_info_change()">저장하기</div>
{% endblock %}

{% block popup_base_js %}
    <script type="text/javascript">

        function func_send_my_info_change(){
            let tel_validation = func_check_tel_format_validity();
            if(tel_validation == false){
                show_error_message('전화번호는 숫자만 입력해주세요.');
                return false;
            }

            $.ajax({
                url:'/trainee/update_trainee_info/',
                type:'POST',
                data : $('#form_my_info').serialize(),
                dataType : 'html',
                async: false,

                beforeSend:function(){
                },

                //통신성공시 처리
                success:function(data){

                    let jsondata = JSON.parse(data);
                    console.log(jsondata)
                    let error_message = jsondata.messageArray;
                    if(error_message.length > 0){
                        layer_popup.close_layer_popup();
                        show_error_message(error_message[0]);
                    }else{
                        layer_popup.close_layer_popup();
                        alert("정보를 변경하였습니다.");
                        location.reload(true);
                    }
                    
                },

                //보내기후 팝업창 닫기
                complete:function(){
                },

                //통신 실패시 처리
                error:function(){

                }
            });
        }

        function func_check_tel_format_validity(){
            let $input_tel = $('input[name="phone"]');
            let special_pattern = /[`~!@#$%^&*+|\\\'\";:\/?\-\_ ]/gi;

            if(special_pattern.test($input_tel.val()) == true){
                return false;
            }else{
                return true;
            }
        }


    </script>
{% endblock %}
