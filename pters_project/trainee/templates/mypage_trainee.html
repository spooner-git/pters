{% extends "trainee_base.html" %}
{% load static %}

{% block local_css %}

        <link rel="stylesheet" href={% static "user/css/trainee/pters.trainee.mypage.css" %}>
        <link rel="stylesheet" href={% static "user/css/pters.add.style.css" %}>
{% endblock %}

{% block content %}

<div id="ymdText">
  <!--
    <div class='arrowButton'>
     <a style="left: 6%;cursor: pointer;"><img src={% static "user/res/daycal_arrow.png" %} alt="" style="width: 7px;"></a>
     <a style="right: 6%;cursor: pointer;"><img src={% static "user/res/daycal_arrow.png" %} alt="" style="-webkit-transform:rotate(180deg);width: 7px;"></a>
    </div>
  -->
    <div id="ymdTextWrap">
         <div id="countRemain"><div style="position: absolute;width: 100%;height: 100%;background: #ffffff;opacity: 0.16;"></div>
            <span id="countRemainData"> 예약 가능 횟수 <span style="color:#fe4e65;font-weight: bold;font-size: 16px;">{{lecture_info.lecture_avail_count}} </span>회</span>
         </div>
        <div id="yearText">회원 정보</div>
        <div id="monthText"></div>
        <div id="menuName">회원 정보
        </div>
        <div id="menuDescription">나의 정보를 확인할 수 있습니다.
        </div>
    </div>
</div>

<div class="gap">
  
</div>


<div class="mypage_label _GRAPH_OPEN">
    <img src="/static/user/res/member/icon-user.png" alt=""><span>월별 활동 그래프</span>
</div>

<div id="mygraph" data-open="0">
    <div id="yyyyText">
        <!--<img src="/static/user/res/icon-calendar-week.png" alt="" class="iconimg">-->
        <a id="leftArrow" style="left: 6%;cursor: pointer;"><img src={% static "user/res/icon-setting-arrow.png" %} alt="" style="-webkit-transform:rotate(180deg);width: 6px;"></a>
        <span id="yy"></span>
        <a id="rightArrow" style="right: 6%;cursor: pointer;"><img src={% static "user/res/icon-setting-arrow.png" %} alt="" style="width: 6px;"></a>
    </div>

    <div id="graph" class="pters_graph">
      <div class="graph_main">
        <div class="graph_vertical">
          <div class="verti">30</div>
          <div class="verti">25</div>
          <div class="verti">20</div>
          <div class="verti">15</div>
          <div class="verti">10</div>
          <div class="verti">5</div>
          <div class="verti"></div>
        </div>
      </div>  
      <div class="graph_horizontal">
        <table>
          <tr>
            <td>1월</td>
            <td>2월</td>
            <td>3월</td>
            <td>4월</td>
            <td>5월</td>
            <td>6월</td>
            <td>7월</td>
            <td>8월</td>
            <td>9월</td>
            <td>10월</td>
            <td>11월</td>
            <td>12월</td>
          </tr>
        </table>
      </div>
    </div> 
</div>

<div id="summary_wrap">
  <div class="mypage_label">
      <img src="/static/user/res/member/icon-user.png" alt=""><span>내 정보 개요</span>
  </div>

  <div id="countBoardWrap">
      <div class="countBoard"><p><img src="/static/user/res/member/icon-able.png" alt="">예약 가능 횟수</p><p><span>{{lecture_avail_count}} </span>회</p></div>
      <div class="countBoard"><p><img src="/static/user/res/member/icon-check.png" alt="">PT 완료 횟수</p><p><span>{{lecture_finish_count}} </span>회</p></div>
  </div>

  <div id="planBoardWrap">
      <div class="planBoard _Next_Info"><p><img src="/static/user/res/member/icon-bell.png" alt="">다음 PT 일정</p><p></p></div>
      <div class="planBoard _Repeat_Info"><p><img src="/static/user/res/member/icon-repeat.png" alt="">PT 반복 일정</p><p style="margin:0;"></p><span></span></div> 
  </div>

  <div id="dateBoardWrap">
      <div class="dateBoard"><p><img src="/static/user/res/member/icon-cal.png" alt="">PT 시작일</p><p>{{ pt_start_date }}</p></div>
      <div class="dateBoard"><p><img src="/static/user/res/member/icon-cal.png" alt="">PT 종료일</p><p>{{ pt_end_date }}</p></div>
  </div>

  <div class="mypage_label">
      <img src="/static/user/res/member/icon-user.png" alt=""><span>담당 트레이너 정보</span>
  </div>
  <div id="trainerInfoWrap">
      <div class="trainerInfo"><span>{{ class_info.mem_info.name }} 트레이너</span><img src="/static/user/res/member/icon-call.png" alt=""><img src="/static/user/res/member/icon-message.png" alt=""></div>
  </div>
</div>


{% endblock %}

{% block local_js_footer %}
        <!-- for db by hk.kim 170805-->
        <script>
            var krHolidayList =  [{% for holiday_day in holiday %}'{{ holiday_day.holiday_dt }}',{% endfor %}];//대한민국 공휴일 (구정, 추석 제외)
        
            //여기를 가져다 써야함 - hkkim 171021;
            var classTimeArray_start_date = [{% for pt_schedule_start_datetime_info in pt_schedule_start_datetime %}'{{ pt_schedule_start_datetime_info }}',{% endfor %}];
        	var classTimeArray_end_date = [{% for pt_schedule_end_datetime_info in pt_schedule_end_datetime %}'{{ pt_schedule_end_datetime_info }}',{% endfor %}];
            var scheduleIdArray = [{% for pt_schedule_id_info in pt_schedule_id %}'{{ pt_schedule_id_info }}',{% endfor %}];
            var scheduleFinishArray =  [{% for pt_schedule_finish_check_info in pt_schedule_finish_check %}'{{ pt_schedule_finish_check_info }}', {% endfor %}];
            var classTimeArray_member_name = [{% for pt_schedule_member_name_info in pt_schedule_member_name %}'{{ pt_schedule_member_name_info }}',{% endfor %}];


            var offTimeArray_start_date = [{% for off_schedule_start_datetime_info in off_schedule_start_datetime %}'{{ off_schedule_start_datetime_info }}',{% endfor %}];
            var offTimeArray_end_date = [{% for off_schedule_end_datetime_info in off_schedule_end_datetime %}'{{ off_schedule_end_datetime_info }}',{% endfor %}];



            var classDateArray = [] //수업날짜 DB데이터 가공후 만들어지는 Array
            var classStartArray = [] //수업시간 DB데이터 가공후 만들어지는 Array

            var ptRepeatScheduleIdArray =  [{% for pt_repeat_schedule_id_info in pt_repeat_schedule_id_data %}'{{ pt_repeat_schedule_id_info }}', {% endfor %}];
            var ptRepeatScheduleTypeArray =  [{% for pt_repeat_schedule_type_info in pt_repeat_schedule_type_data %}'{{ pt_repeat_schedule_type_info }}', {% endfor %}];
            var ptRepeatScheduleWeekInfoArray =  [{% for pt_repeat_schedule_week_info_info in pt_repeat_schedule_week_info_data %}'{{ pt_repeat_schedule_week_info_info }}', {% endfor %}];
            var ptRepeatScheduleStartDateArray =  [{% for pt_repeat_schedule_start_date_info in pt_repeat_schedule_start_date_data %}'{{ pt_repeat_schedule_start_date_info }}', {% endfor %}];
            var ptRepeatScheduleEndDateArray =  [{% for pt_repeat_schedule_end_date_info in pt_repeat_schedule_end_date_data %}'{{ pt_repeat_schedule_end_date_info }}', {% endfor %}];
            var ptRepeatScheduleStartTimeArray =  [{% for pt_repeat_schedule_start_time_info in pt_repeat_schedule_start_time_data %}'{{ pt_repeat_schedule_start_time_info }}', {% endfor %}];
            var ptRepeatScheduleTimeDurationArray =  [{% for pt_repeat_schedule_time_duration_info in pt_repeat_schedule_time_duration_data %}'{{ pt_repeat_schedule_time_duration_info }}', {% endfor %}];


            var next_schedule = ['{{ next_schedule }}'];
            var lt_res_01 =  ['{{ lt_res_01 }}'];
            var lt_res_02 =  ['{{ lt_res_02 }}'];
            var lt_res_03 =  ['{{ lt_res_03 }}'];
        </script>

        <!-- Placed at the end of the document so the pages load faster -->

        <script type="text/javascript" src={% static "user/js/trainee/pters.trainee.mypage.js" %}></script> <!--달력에 대한 JS-->
        <script>

            $('#uptext').text("마이페이지")
            $('#upbutton').attr('onclick',"location.href='{% url 'trainee:cal_month'%}'")
            $('#upbutton img').attr('src','/static/user/res/icon-setting-arrow.png').css({'transform':'rotate(180deg)','height':'20px','width':'unset'})

            $('._GRAPH_OPEN').click(function(){
              if($('#mygraph').attr('data-open') == '0'){
                  $('#mygraph').css('transform','translateY(0%)').attr('data-open','1')
                  $('#summary_wrap').css('transform','translateY(0%)')
                  
              }else if($('#mygraph').attr('data-open') == "1"){
                  $('#mygraph').css('transform','translateY(-200%)').attr('data-open','0')
                  $('#summary_wrap').css('transform','translateY(-60%)')

              }
            })

            var repeat_info_dict= { 'KOR':
                                  {'DD':'매일', 'WW':'매주', '2W':'격주',
                                   'SUN':'일요일', 'MON':'월요일','TUE':'화요일','WED':'수요일','THS':'목요일','FRI':'금요일', 'SAT':'토요일'},
                                  'JAP':
                                  {'DD':'毎日', 'WW':'毎週', '2W':'隔週',
                                   'SUN':'日曜日', 'MON':'月曜日','TUE':'火曜日','WED':'水曜日','THS':'木曜日','FRI':'金曜日', 'SAT':'土曜日'},
                                  'JAP':
                                  {'DD':'Everyday', 'WW':'Weekly', '2W':'Bi-weekly',
                                   'SUN':'Sun', 'MON':'Mon','TUE':'Tue','WED':'Wed','THS':'Thr','FRI':'Fri', 'SAT':'Sat'}
                                 }

            if('{{next_schedule_start_dt }}'.length>0){
              var trainee_next_schedule = db_datatimehangul_format_realign('{{next_schedule_start_dt }}')
            }else{
              var trainee_next_schedule = "일정이 없습니다."
            }

            if(ptRepeatScheduleTypeArray.length>0){
                var trainee_repeat_type = repeat_info_dict[Options.language][ptRepeatScheduleTypeArray[0]]
                var trainee_repeat_day = function(){
                                          var repeat_day_info_raw = ptRepeatScheduleWeekInfoArray[0].split('/')
                                          var repeat_day_info = ""
                                          if(repeat_day_info_raw.length>1){
                                              for(var j=0; j<repeat_day_info_raw.length; j++){
                                                  var repeat_day_info = repeat_day_info + '/' + repeat_info_dict['KOR'][repeat_day_info_raw[j]].substr(0,1)
                                              }
                                          }else if(repeat_day_info_raw.length == 1){
                                              var repeat_day_info = repeat_info_dict['KOR'][repeat_day_info_raw[0]]
                                          }
                                          if(repeat_day_info.substr(0,1) == '/'){
                                              var repeat_day_info = repeat_day_info.substr(1,repeat_day_info.length)
                                          }
                                            return repeat_day_info
                                        };
                var trainee_repeat_time = time_format_to_hangul(ptRepeatScheduleStartTimeArray[0])
                var trainee_repeat_end = '반복종료 : '+ date_format_to_hangul(ptRepeatScheduleEndDateArray[0])
            }else{
                var trainee_repeat_type = ''
                var trainee_repeat_day = '-'
                var trainee_repeat_time = ''
                var trainee_repeat_end = ''
            }

            $('#planBoardWrap > div.planBoard._Next_Info > p:nth-child(2)').text(trainee_next_schedule)
            $('._Repeat_Info p:nth-child(2)').text(trainee_repeat_type+' '
                                                  +trainee_repeat_day() + ' '
                                                  +trainee_repeat_time)
            $('._Repeat_Info span').text(trainee_repeat_end)
              
            
        </script>

{% endblock %}
