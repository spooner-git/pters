{% load static %}
{% block local_css %}

    <meta name="login" content="pwreset_login">
    <link rel="stylesheet" href={% static "user/css/trainer/pters.trainer.register.css" %}>
    <style type="text/css">
    	#submit_input{
    		overflow-y: hidden;
    		margin: 0;
    		transition: 0.3s;
    		-webkit-transition: 0.3s;
    		height: 200px;
    	}
    	#submit_complete{
    		height: 0;
    		transition: 0.5s;
    		-webkit-transition: 0.5s;
    		overflow-y: hidden;
    		margin: 0;
    		padding-left: 20px;
    		font-size: 14px;
    	}
    	.submit_reset_pw,.submit_go_home{
    		position: relative !important;
    		margin: 0 auto !important;
    		margin-top: 40px !important;
    		left: unset !important;
    		transform: unset !important;
    	}
    	.submit_go_home{
    		color: #fe4e65 !important;
    		position: relative !important;
    		margin: 0 auto !important;
    		margin-top: 15px !important;
    		left: unset !important;
    		transform: unset !important;
    	}
    	#ajaxloadingPC{
  			position: fixed;
  			display: none;
  			height: 60px;
  			left: 50%;
  			transform:translate(-50%,-50%);
  			z-index: 202;
  		}

      #inputError_info{
        overflow-y: hidden;
        height: 0;
        max-width: 276px;
        border: 0;
        background: red;
        transition: 0.4s;
      }
        #errorMsg_info{
          margin-top: 0;
          border: 0;
        }
        #inputError_info p{
          color: #ffffff;
          line-height: 30px;
          vertical-align: middle;
          margin:0;
        }


    </style>

{% endblock %}

{% load i18n %}

{% block content %}
<div class="outerbox_horizontal" data-view="init" style="width:auto;">
  <div id="inputError_info">
        <div id="errorMsg_info" class="inputErrorInner">
            <p></p>
        </div>
  </div>
	<div class="explainbox _type_trainee">
		<img src="/static/user/res/login/icon-reg-user.png">
		<p><span class="font-pink">비밀번호 초기화</span><br>가입시 입력한 이메일 주소로 <br>초기화 메일을 전송합니다.</p>
		<div class="explaintype" id="submit_input">
			<form method="post" action="." style="text-align: center!important;padding-left: 20px;">
			  	{% csrf_token %} 
			  	{{ form.as_p }}

			  	<!--<input type="submit" value="{% trans 'Submit' %}" />-->
			</form>	
			<button class="submit_reset_pw" >초기화 메일 보내기</button>
			<button class="submit_go_home" onclick="goHome()">뒤로</button>
			<img src="/static/user/res/ajax/loading.gif" alt="" class="ajaxloadingPC" id="ajaxloadingPC">
		</div>
		<div class="explaintype" id="submit_complete">
			<p>입력하신 메일주소로</p>
			<p>초기화 된 비밀번호가 전송되었습니다.</p>
			<p>메일 확인 후 비밀번호를 변경해 주세요.</p>
			<button class="submit_go_home" onclick="goHome()">로그인 페이지</button>
		</div>
	</div>
</div>

{% endblock %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
	$('button.submit_reset_pw').click(function(){
		$form = $('#submit_input form')
		$.ajax({
              //url:'/accounts/password/reset/',
              url:'/login/reset_password/',
              type:'POST',
              data:$form.serialize(),
              dataType : 'html',

              beforeSend:function(){
              	beforeSend()
              },

              //보내기후 팝업창 닫기
              complete:function(){
              	completeSend()
              },

              //통신성공시 처리
              success:function(data){
                  jsondata = JSON.parse(data)
                  console.log(jsondata)
                  if(jsondata.messageArray.length==0){
                    $('#submit_complete').css('height','200px')
                    $('#submit_input').css('height','0px')
                  }else{
                    $('#inputError_info').css('height','30px')
                    $('#errorMsg_info p').text(jsondata.messageArray)
                  }
                  
              },

              //통신 실패시 처리
              error:function(){
                alert("서버 통신 에러가 발생하였습니다. 잠시후 다시 시도해주세요")
              },
          })
	})

  $('input#id_email').keyup(function(){
      $('#inputError_info').css('height','0px')
  })

	function beforeSend(){
        $('html').css("cursor","wait");
        $('#ajaxloadingPC').css('display','block');
        $('#submit_input button').css('visibility','hidden')
    }

    function completeSend(){
        $('html').css("cursor","auto");
        $('#ajaxloadingPC').css('display','none');
        $('#submit_input button').css('visibility','visible')
    }

    function goHome(){
        location.href="{% url 'login:logout' %}"
    }
</script>
